name: CI
on:
    push:
        branches:
            - "main"
        tags:
            - "v[0-9]+.[0-9]+.[0-9]+"
    pull_request:
        branches: [ main ]
jobs:
    test-unit:
        name: Run unit tests
        runs-on: ubuntu-latest
        strategy:
            matrix:
                python-version:
                    - "3.7"
        steps:
            -   uses: actions/checkout@v2
            -   name: Setup python
                uses: actions/setup-python@v2
                with:
                    python-version: ${{ matrix.python-version }}
            -   name: Install Poetry
                run: curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python3 -
            -   name: Install Code
                run: |
                    source "$HOME/.poetry/env"
                    poetry install
            -   name: Run pytest
                run: |
                    source "$HOME/.poetry/env"
                    poetry run pytest
    compliance-copyrights:
        name: Compliance Copyright Headers
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout
                uses: actions/checkout@v2
            -   name: Check License Header
                uses: apache/skywalking-eyes@0.1.0